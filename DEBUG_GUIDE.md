# GPT-5 调试指南

## 概述

为了帮助您调试 GPT-5 模型不返回内容的问题，我已经在项目中添加了详细的调试日志和测试工具。

## 新增的调试功能

### 1. 详细的调试日志

#### 后端日志 (src/lib/openai.ts)
- 🚀 API 请求开始
- 📋 请求参数详情
- 📤 最终请求参数
- ⏳ 请求发送状态
- ✅ 请求成功信息
- ❌ 详细错误信息

#### Responses API 路由日志 (src/app/api/responses/route.ts)
- 🎯 请求接收和 ID 分配
- 📋 请求体解析
- 🔍 参数验证
- 🚀 API 调用状态
- 🌊 流式响应处理
- 📨 每个事件的详细信息
- 💾 数据库保存状态
- 🏁 响应完成统计

#### 前端日志 (src/components/ChatInterface.tsx)
- 🚀 请求发送
- 📡 响应状态
- 🌊 流式响应处理
- 📨 事件解析
- 📝 内容更新
- 🧠 推理内容
- 🔧 工具调用
- ✅ 响应完成

### 2. 调试页面

访问 `/debug` 页面可以进行以下操作：

#### 环境变量检查
- 验证 API Key 是否存在
- 检查 Base URL 配置
- 显示环境变量状态

#### API 连接测试
- 直接测试 GPT-5 API 连接
- 发送简单测试请求
- 显示响应时间和内容

#### 实时日志监控
- 拦截并显示所有 console.log 输出
- 实时查看调试信息
- 支持清空日志

#### GPT-5 功能测试
- 测试完整的 GPT-5 请求流程
- 显示详细的请求和响应数据
- 支持自定义输入内容

### 3. API 端点

#### GET /api/debug/env
检查环境变量配置状态

#### GET /api/debug/test-connection
测试与 OpenAI API 的连接

## 使用方法

### 1. 启动项目并访问调试页面
```bash
# 启动开发服务器
npm run dev

# 访问调试页面
http://localhost:3000/debug
```

### 2. 检查环境配置
1. 点击"环境变量检查"按钮
2. 确认 API Key 和 Base URL 配置正确

### 3. 测试 API 连接
1. 点击"API 连接测试"按钮
2. 查看是否能成功连接到 GPT-5 API

### 4. 测试完整功能
1. 在输入框中输入测试内容
2. 点击"测试 GPT-5"按钮
3. 观察右侧的实时日志输出
4. 查看响应结果

### 5. 查看浏览器控制台
打开浏览器开发者工具的 Console 标签页，可以看到更详细的日志信息。

## 常见问题排查

### 1. 环境变量问题
如果环境检查失败：
- 确认 `.env.local` 文件存在
- 检查 `AIHUBMIX_API_KEY` 是否正确设置
- 验证 `AIHUBMIX_BASE_URL` 是否正确

### 2. API 连接问题
如果连接测试失败：
- 检查网络连接
- 验证 API Key 是否有效
- 确认 Base URL 是否正确
- 查看错误详情中的状态码和错误信息

### 3. GPT-5 不返回内容
如果 GPT-5 测试没有返回内容：
- 查看日志中是否有错误信息
- 检查 API 响应的原始数据
- 确认模型参数设置是否正确
- 验证 Responses API 的事件流处理

### 4. 流式响应问题
如果流式响应有问题：
- 查看事件计数和类型
- 检查是否收到 'content.delta' 事件
- 验证 'done' 事件是否正常触发

## 日志格式说明

### 日志前缀含义
- 🚀 开始/启动
- 📋 参数/配置
- 📤 发送请求
- 📥 接收响应
- 🌊 流式处理
- 📨 事件处理
- 📝 内容更新
- 🧠 推理内容
- 🔧 工具调用
- 💾 数据库操作
- ✅ 成功操作
- ❌ 错误信息
- ⚠️ 警告信息
- 🔍 检查/验证
- 🏁 完成/结束

### 请求 ID
每个请求都会分配一个唯一的 ID（如 `abc123`），方便在日志中跟踪特定请求的完整流程。

## 下一步

1. 使用调试页面测试 GPT-5 功能
2. 查看详细的日志输出
3. 根据日志信息定位问题
4. 如果需要进一步帮助，请提供具体的错误日志
